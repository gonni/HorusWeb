@()(implicit request: javax.servlet.http.HttpServletRequest)
@import org.scalatra.forms.views._

<script>
    function crawlList() {
        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/core/crawl/list');
        xhr.setRequestHeader('content-type', 'application/json');

        let targetUrl = document.getElementById('urlPattern').value;
        let listUrlPattern = document.getElementById('listUrlPattern').value;
        let areaFilter = document.getElementById('listTopAreaFilter').value;

        console.log(targetUrl + ' | ' + listUrlPattern + ' | ' + areaFilter) ;

        let reqBody = JSON.stringify({
            targetSeedUrl: targetUrl,
            filterCrawlUrlRxPattern: listUrlPattern,
            filterDomGroupAttr: areaFilter
        });
        console.log('send json ->' + reqBody);
        xhr.send(reqBody);

        xhr.onload = () => {
            if (xhr.status === 200 || xhr.status === 201) {
                let table = document.getElementById("cralwedResult") ;
                let jsRes = JSON.parse(xhr.response) ;
                console.log('jsRes -> ' + jsRes.lstCrawls.length)

                let lstCu = jsRes.lstCrawls
                for(let i=0; i< lstCu.length; i++) {
                    console.log(lstCu[i].url + ":" + lstCu[i].anchorText)
                    let tr = document.createElement("tr") ;

                    let td1 = document.createElement("td") ;
                    td1.appendChild(document.createTextNode(lstCu[i].anchorText));

                    let td2 = document.createElement("td") ;
                    td2.appendChild(document.createTextNode(lstCu[i].url));

                    tr.appendChild(document.createTextNode(''+ i)) ;
                    tr.appendChild(td1) ;
                    tr.appendChild(td2) ;

                    table.appendChild(tr);
                }
                //document.querySelector('pre').textContent = xhr.response;
            } else {
                console.error('Error', xhr.status, xhr.statusText);
            }
        };
    }
</script>


<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
    <h3>Doc Lab</h3>
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">Anchors</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Content</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact" type="button" role="tab" aria-controls="contact" aria-selected="false">MultiBus</button>
        </li>
    </ul>

    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            <div class="table-responsive">
                <!-- <form method="post" action="/admin/config/seed/list/validate"> -->

                    <div class="mb-3">
                        <label for="urlPattern" class="form-label">URL Pattern</label>
                            <!-- <input type="text" class="form-control" id="urlPattern"> -->

                        <div class="col-sm-10">
                            @Html(text("urlPattern", "class" -> "form-control", "id" -> "urlPattern"))
         5                   <span class="error">@error("title")</span>
                        </div>
                        <div id="emailHelp" class="form-text">
                            ex) https://news.naver.com/main/list.naver?mode=LS2D&sid2=263&sid1=101&mid=sec&listType=title&date=20220621&page=1
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="listUrlPattern" class="form-label">List.UrlPatternFilter</label>
                            <!-- <input type="text" class="form-control" id="listUrlPattern"> -->
                        @Html(text("listUrlPattern", "class" -> "form-control", "id" -> "listUrlPattern"))
                        <div id="emailHelp" class="form-text">
                            ex) ^(https://n.news.naver.com/mnews/).*$
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="listTopAreaFilter" class="form-label">List.TopAreaFilter</label>
                            <!-- <input type="text" class="form-control" id="listTopAreaFilter"> -->
                        @Html(text("listTopAreaFilter", "class" -> "form-control", "id" -> "listTopAreaFilter"))
                        <div id="emailHelp" class="form-text">
                            ex) ul.type02
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" onclick="crawlList()">Validate</button>
                <!-- </form> -->
                <table border='2' id="cralwedResult" >
                </table>
            </div>

        </div>
        <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">TBD</div>
        <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">Nil</div>
    </div>
    <pre></pre>

</main>